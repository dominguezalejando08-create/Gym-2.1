<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MONOS FIT | Pro Training</title>
    <style>
        :root {
            --primary: #2563eb;
            --primary-dark: #1e40af;
            --secondary: #1e293b;
            --accent: #22c55e;
            --danger: #ef4444;
            --warning: #f59e0b;
            --bg: #f8fafc;
            --card-bg: #ffffff;
            --text-main: #0f172a;
            --text-muted: #64748b;
            --radius: 12px;
            --shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1);
        }

        body {
            margin: 0;
            font-family: 'Inter', system-ui, -apple-system, sans-serif;
            background: var(--bg);
            color: var(--text-main);
            padding-bottom: 40px;
        }

        /* --- Header & Nav --- */
        header {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: #fff;
            padding: 1.5rem 1rem;
            text-align: center;
            box-shadow: var(--shadow);
        }
        nav {
            display: flex;
            background: var(--secondary);
            position: sticky;
            top: 0;
            z-index: 100;
            overflow-x: auto;
        }
        nav button {
            flex: 1;
            min-width: 90px;
            border: none;
            background: transparent;
            color: #94a3b8;
            padding: 1rem 0.5rem;
            font-weight: 600;
            font-size: 0.75rem;
            cursor: pointer;
            text-transform: uppercase;
        }
        nav button.active { color: #fff; background: var(--primary); }

        /* --- Layout --- */
        section { display: none; max-width: 800px; margin: 1.5rem auto; padding: 0 1rem; animation: slideUp 0.3s ease-out; }
        section.active { display: block; }
        @keyframes slideUp { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        .card {
            background: var(--card-bg);
            border-radius: var(--radius);
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            box-shadow: var(--shadow);
            border: 1px solid #e2e8f0;
        }

        /* --- Forms & Buttons --- */
        .grid-inputs { display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 12px; margin-bottom: 1rem; }
        label { display: block; margin-bottom: 4px; font-weight: 600; font-size: 0.8rem; color: var(--text-muted); }
        input, select {
            width: 100%;
            padding: 0.7rem;
            border-radius: 8px;
            border: 1px solid #cbd5e1;
            box-sizing: border-box;
        }
        .btn {
            padding: 0.8rem;
            border-radius: 8px;
            border: none;
            font-weight: 600;
            cursor: pointer;
            width: 100%;
            transition: 0.2s;
        }
        .btn-primary { background: var(--primary); color: #fff; }
        .btn-success { background: var(--accent); color: #fff; }
        .btn-danger { background: var(--danger); color: #fff; }

        /* --- Evoluci√≥n Table --- */
        .history-table { width: 100%; border-collapse: collapse; font-size: 0.85rem; margin-top: 1rem; }
        .history-table th { background: #f1f5f9; padding: 10px; text-align: left; color: var(--text-muted); }
        .history-table td { padding: 10px; border-bottom: 1px solid #f1f5f9; }

        /* --- Dieta UI --- */
        .diet-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 5px; }
        .diet-day { padding: 8px 2px; text-align: center; border-radius: 6px; background: #f1f5f9; cursor: pointer; font-size: 0.7rem; border: 1px solid transparent; }
        .diet-day.active-a { background: #dbeafe; border-color: var(--primary); }
        .diet-day.active-b { background: #fef3c7; border-color: var(--warning); }

        /* --- Exercies UI --- */
        .exercise-item { display: flex; align-items: center; gap: 15px; padding: 10px 0; border-bottom: 1px solid #f1f5f9; }
        .ex-img { width: 60px; height: 60px; border-radius: 8px; object-fit: cover; background: #eee; }
        
        #timer-display {
            position: fixed; bottom: 20px; right: 20px; background: var(--secondary);
            color: white; padding: 10px 20px; border-radius: 30px; display: none; z-index: 1000;
        }
    </style>
</head>
<body>

<header>
    <h1>üèãÔ∏è MONOS FITNESS üêµ</h1>
    <p>Seguimiento Corporal Pro</p>
</header>

<nav>
    <button class="active" data-section="semana">Semana</button>
    <button data-section="rutina">Rutina</button>
    <button data-section="dieta">Dieta</button>
    <button data-section="progreso">Evoluci√≥n</button>
    <button data-section="config">Config</button>
</nav>

<section id="semana" class="active">
    <h2>üìÖ Mi semana</h2>
    <div id="resumenSemanal"></div>
    <button class="btn btn-primary" onclick="reiniciarSemana()">üîÑ Reiniciar Checkbox Semanal</button>
</section>

<section id="rutina">
    <div class="card">
        <h3>A√±adir Ejercicio</h3>
        <div class="grid-inputs">
            <label>D√≠a <select id="diaRutina"><option>1</option><option>2</option><option>3</option><option>4</option><option>5</option><option>6</option></select></label>
            <label>Ejercicio <input id="nombreEj" placeholder="Ej: Sentadillas"></label>
            <label>Series <input id="series" placeholder="Ej: 4x12"></label>
            <label>Imagen <input type="file" id="imgFile" accept="image/*"></label>
        </div>
        <button class="btn btn-primary" onclick="agregarEjercicio()">+ Guardar Ejercicio</button>
    </div>
    <div id="listaRutinas"></div>
</section>

<section id="dieta">
    <div id="dietaHoyContainer"></div>
    <div class="card">
        <h3>‚öôÔ∏è Configurar Men√∫s</h3>
        <div style="display:flex; gap:10px; margin-bottom:10px">
            <button class="btn btn-primary" style="flex:1" onclick="cambiarEditorDieta('A')">Men√∫ A</button>
            <button class="btn btn-primary" style="background:#fbbf24; flex:1" onclick="cambiarEditorDieta('B')">Men√∫ B</button>
        </div>
        <div id="editorDietaForm" style="background:#f8fafc; padding:15px; border-radius:8px">
            <h4 id="editTitle" style="margin:0 0 10px 0">Editando Men√∫ A</h4>
            <div class="grid-inputs">
                <label>üç≥ Desayuno <input id="d_desayuno"></label>
                <label>ü•™ Snack 1 <input id="d_snack1"></label>
                <label>üçΩÔ∏è Comida <input id="d_comida"></label>
                <label>üçé Snack 2 <input id="d_snack2"></label>
                <label>üåô Cena <input id="d_cena"></label>
            </div>
            <button class="btn btn-success" onclick="guardarMenu()">üíæ Guardar Cambios</button>
        </div>
    </div>
    <div class="card">
        <h3>üìÖ Ciclo de 28 D√≠as</h3>
        <div class="diet-grid" id="grid28"></div>
    </div>
</section>

<section id="progreso">
    <h2>üìä Evoluci√≥n Corporal</h2>
    <div class="card">
        <h3>Nuevo Registro</h3>
        <div class="grid-inputs">
            <label>Peso (kg) <input id="p_peso" type="number" step="0.1"></label>
            <label>Grasa (%) <input id="p_grasa" type="number" step="0.1"></label>
            <label>M√∫sculo (%) <input id="p_musculo" type="number" step="0.1"></label>
            <label>Cintura (cm) <input id="p_cintura" type="number" step="0.1"></label>
            <label>Cadera (cm) <input id="p_cadera" type="number" step="0.1"></label>
        </div>
        <button class="btn btn-success" onclick="guardarProgreso()">üíæ Guardar Medidas de Hoy</button>
    </div>

    <div class="card" style="overflow-x: auto;">
        <h3>üìà Hist√≥rico de Cambios</h3>
        <table class="history-table">
            <thead>
                <tr>
                    <th>Fecha</th>
                    <th>Peso</th>
                    <th>Grasa</th>
                    <th>M√∫sc.</th>
                    <th>Cint.</th>
                    <th>Cad.</th>
                    <th>Acci√≥n</th>
                </tr>
            </thead>
            <tbody id="tablaProgreso"></tbody>
        </table>
    </div>
</section>

<section id="config">
    <div class="card">
        <h3>Gesti√≥n de Datos</h3>
        <button class="btn btn-primary" style="margin-bottom:10px" onclick="exportarDatos()">üì§ Exportar Backup</button>
        <button class="btn btn-danger" onclick="borrarTodo()">‚ö†Ô∏è Reset Total</button>
    </div>
</section>

<div id="timer-display">Descanso: <span id="timer-secs">60</span>s</div>

<script>
let DB = {
    rutinas: {},
    dieta: { menuA: {}, menuB: {}, plan: {} },
    progreso: []
};

function saveDB() { localStorage.setItem('MONOS_FIT_DB_V2', JSON.stringify(DB)); }
function loadDB() {
    const data = localStorage.getItem('MONOS_FIT_DB_V2');
    if (data) DB = JSON.parse(data);
    else { for(let i=1; i<=28; i++) DB.dieta.plan[i] = (i%2===0) ? 'B' : 'A'; saveDB(); }
}

// --- NAVEGACI√ìN ---
document.querySelectorAll('nav button').forEach(btn => {
    btn.addEventListener('click', () => {
        document.querySelectorAll('nav button').forEach(b => b.classList.remove('active'));
        document.querySelectorAll('section').forEach(s => s.classList.remove('active'));
        btn.classList.add('active');
        document.getElementById(btn.dataset.section).classList.add('active');
        if(btn.dataset.section === 'semana') renderSemana();
        if(btn.dataset.section === 'dieta') renderDieta();
        if(btn.dataset.section === 'progreso') renderProgreso();
    });
});

// --- RUTINAS ---
function agregarEjercicio() {
    const dia = document.getElementById('diaRutina').value;
    const nombre = document.getElementById('nombreEj').value;
    const series = document.getElementById('series').value;
    const file = document.getElementById('imgFile').files[0];
    if(!nombre || !series) return alert("Faltan datos");

    const reader = new FileReader();
    reader.onload = (e) => {
        if(!DB.rutinas[dia]) DB.rutinas[dia] = [];
        DB.rutinas[dia].push({ nombre, series, img: e.target.result || '', done: false });
        saveDB(); renderListaEjercicios();
        alert("¬°Ejercicio listo!");
    };
    if(file) reader.readAsDataURL(file); else reader.onload({});
}

function renderListaEjercicios() {
    const container = document.getElementById('listaRutinas');
    container.innerHTML = '';
    Object.keys(DB.rutinas).sort().forEach(dia => {
        const div = document.createElement('div');
        div.className = 'card';
        div.innerHTML = `<h3>D√≠a ${dia}</h3>`;
        DB.rutinas[dia].forEach((ej, idx) => {
            div.innerHTML += `
                <div class="exercise-item">
                    <img src="${ej.img || ''}" class="ex-img" onerror="this.style.display='none'">
                    <div style="flex:1"><b>${ej.nombre}</b><br><small>${ej.series}</small></div>
                    <input type="checkbox" ${ej.done?'checked':''} onchange="toggleEj(${dia},${idx})">
                    <button class="btn btn-danger" style="width:auto; padding:5px 10px" onclick="eliminarEj(${dia},${idx})">üóëÔ∏è</button>
                </div>`;
        });
        container.appendChild(div);
    });
}
function toggleEj(dia, idx) { 
    DB.rutinas[dia][idx].done = !DB.rutinas[dia][idx].done; 
    if(DB.rutinas[dia][idx].done) iniciarDescanso();
    saveDB(); 
}
function eliminarEj(dia, idx) { DB.rutinas[dia].splice(idx,1); saveDB(); renderListaEjercicios(); }

function iniciarDescanso() {
    const display = document.getElementById('timer-display');
    const secsText = document.getElementById('timer-secs');
    let tiempo = 60; display.style.display = 'block';
    const int = setInterval(() => {
        tiempo--; secsText.textContent = tiempo;
        if(tiempo <= 0) { clearInterval(int); display.innerHTML = "ü¶ç ¬°DALE!"; setTimeout(()=>display.style.display='none',2000); }
    }, 1000);
}

// --- DIETA ---
let editMenu = 'A';
function cambiarEditorDieta(t) {
    editMenu = t; document.getElementById('editTitle').textContent = `Editando Men√∫ ${t}`;
    const m = DB.dieta[`menu${t}`];
    ['desayuno','snack1','comida','snack2','cena'].forEach(k => document.getElementById(`d_${k}`).value = m[k] || '');
}
function guardarMenu() {
    const m = DB.dieta[`menu${editMenu}`];
    ['desayuno','snack1','comida','snack2','cena'].forEach(k => m[k] = document.getElementById(`d_${k}`).value);
    saveDB(); renderDieta(); alert("Men√∫ guardado");
}
function renderDieta() {
    const grid = document.getElementById('grid28'); grid.innerHTML = '';
    for(let i=1; i<=28; i++) {
        const d = document.createElement('div');
        d.className = `diet-day ${DB.dieta.plan[i]=='A'?'active-a':'active-b'}`;
        d.innerHTML = `${i}<br>${DB.dieta.plan[i]}`;
        d.onclick = () => { DB.dieta.plan[i] = DB.dieta.plan[i]=='A'?'B':'A'; saveDB(); renderDieta(); };
        grid.appendChild(d);
    }
    const hoy = ((new Date().getDate()-1)%28)+1;
    const m = DB.dieta[`menu${DB.dieta.plan[hoy]}`];
    document.getElementById('dietaHoyContainer').innerHTML = `
        <div class="card" style="border-left:5px solid var(--accent)">
            <h3 style="margin:0">Hoy: Men√∫ ${DB.dieta.plan[hoy]} (D√≠a ${hoy})</h3>
            <p style="font-size:0.9rem">üç≥ ${m.desayuno||'---'} | ü•™ ${m.snack1||'---'} | üçΩÔ∏è ${m.comida||'---'} | üçé ${m.snack2||'---'} | üåô ${m.cena||'---'}</p>
        </div>`;
}

// --- PROGRESO (EVOLUCI√ìN) ---
function guardarProgreso() {
    const registro = {
        fecha: new Date().toLocaleDateString('es-ES', {day:'2-digit', month:'2-digit'}),
        peso: document.getElementById('p_peso').value || '-',
        grasa: document.getElementById('p_grasa').value || '-',
        musculo: document.getElementById('p_musculo').value || '-',
        cintura: document.getElementById('p_cintura').value || '-',
        cadera: document.getElementById('p_cadera').value || '-'
    };
    DB.progreso.unshift(registro);
    saveDB(); renderProgreso();
    // Limpiar inputs
    ['p_peso','p_grasa','p_musculo','p_cintura','p_cadera'].forEach(id => document.getElementById(id).value = '');
}

function renderProgreso() {
    const tabla = document.getElementById('tablaProgreso');
    tabla.innerHTML = '';
    DB.progreso.forEach((r, idx) => {
        tabla.innerHTML += `
            <tr>
                <td>${r.fecha}</td>
                <td>${r.peso}k</td>
                <td>${r.grasa}%</td>
                <td>${r.musculo}%</td>
                <td>${r.cintura}</td>
                <td>${r.cadera}</td>
                <td><button onclick="borrarProgres(${idx})" style="border:none; background:none; cursor:pointer">‚ùå</button></td>
            </tr>`;
    });
}
function borrarProgres(idx) { DB.progreso.splice(idx,1); saveDB(); renderProgreso(); }

// --- SEMANA ---
function renderSemana() {
    const container = document.getElementById('resumenSemanal');
    container.innerHTML = '';
    for(let i=1; i<=6; i++) {
        const ejs = DB.rutinas[i] || [];
        const done = ejs.filter(e => e.done).length;
        const total = ejs.length;
        const pc = total ? Math.round((done/total)*100) : 0;
        container.innerHTML += `
            <div class="card" style="padding:10px; margin-bottom:10px">
                <div style="display:flex; justify-content:space-between"><b>D√≠a ${i}</b> <span>${pc}%</span></div>
                <div style="background:#eee; height:8px; border-radius:4px; margin-top:5px">
                    <div style="background:var(--accent); height:100%; width:${pc}%; border-radius:4px; transition:0.3s"></div>
                </div>
            </div>`;
    }
}
function reiniciarSemana() { if(confirm("¬øDesmarcar todo?")) { Object.keys(DB.rutinas).forEach(d=>DB.rutinas[d].forEach(e=>e.done=false)); saveDB(); renderSemana(); } }
function exportarDatos() { 
    const blob = new Blob([JSON.stringify(DB)], {type:'application/json'});
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a'); a.href = url; a.download = 'monos_fit.json'; a.click();
}
function borrarTodo() { if(confirm("CUIDADO: Borrar√° TODO")) { localStorage.clear(); location.reload(); } }

// INIT
loadDB();
renderListaEjercicios();
renderSemana();
</script>
</body>
</html>
