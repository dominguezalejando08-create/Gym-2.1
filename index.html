<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>MONOS FIT | Sistema de Socio</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap');

        :root {
            --primary: #9d4edd; --accent: #ff85a1; --bg: #fff5f8; --card: #ffffff;
            --text: #4a1e4a; --text-light: #8e7d8e; --shadow: 0 10px 30px rgba(0,0,0,0.05);
            --radius: 20px; --border: rgba(0,0,0,0.08);
        }

        .tema-ni√±a { --primary: #9d4edd; --accent: #ff85a1; --bg: #fff5f8; --gradient: linear-gradient(135deg, #fbc2eb 0%, #a6c1ee 100%); }
        .tema-ni√±o { --primary: #2563eb; --accent: #22c55e; --bg: #f1f5f9; --text: #0f172a; --text-light: #64748b; --gradient: linear-gradient(135deg, #3b82f6 0%, #22c55e 100%); }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        
        body { 
            margin: 0; font-family: 'Poppins', sans-serif; background-color: var(--bg); color: var(--text); 
            width: 100vw; overflow-x: hidden; padding-bottom: 90px; transition: 0.3s;
        }

        /* Pantalla de Inicio - Adaptable */
        #pantalla-inicio { 
            position: fixed; inset: 0; background: #fff; z-index: 9999; 
            display: flex; flex-direction: column; align-items: center; justify-content: center; 
            padding: 30px; text-align: center;
        }
        
        header { 
            padding: 35px 20px; text-align: center; background: var(--gradient); color: white; 
            border-bottom-left-radius: 35px; border-bottom-right-radius: 35px; position: relative;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        #socio-display { 
            position: absolute; top: 12px; left: 20px; font-size: 0.7rem; font-weight: 800; 
            background: rgba(0,0,0,0.25); padding: 5px 12px; border-radius: 20px; letter-spacing: 0.5px;
        }

        /* Navegaci√≥n Fija y Est√©tica */
        nav { 
            display: flex; background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(10px); 
            position: fixed; bottom: 0; width: 100%; max-width: 100%; z-index: 1000; 
            justify-content: space-around; border-top: 1px solid var(--border); padding: 10px 0;
            box-shadow: 0 -5px 20px rgba(0,0,0,0.05);
        }
        nav button { 
            border: none; background: none; font-weight: 600; font-size: 0.6rem; 
            color: var(--text-light); cursor: pointer; display: flex; flex-direction: column; 
            align-items: center; transition: 0.2s;
        }
        nav button span { font-size: 1.4rem; margin-bottom: 2px; }
        nav button.active { color: var(--primary); transform: translateY(-2px); }

        /* Contenedores de Secci√≥n */
        section { 
            display: none; width: 100%; max-width: 500px; margin: 0 auto; 
            padding: 20px 15px; animation: fadeIn 0.3s ease-out; 
        }
        section.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }

        /* Tarjetas y UI */
        .card { 
            background: var(--card); border-radius: var(--radius); padding: 20px; 
            margin-bottom: 15px; box-shadow: var(--shadow); border: 1px solid var(--border); 
        }
        .ex-card { 
            display: flex; align-items: center; gap: 12px; padding: 12px; 
            background: var(--card); border-radius: 15px; margin-bottom: 10px; 
            border: 1px solid var(--border); box-shadow: 0 2px 8px rgba(0,0,0,0.02);
        }
        .ex-img { width: 55px; height: 55px; border-radius: 12px; object-fit: cover; background: #f0f0f0; }
        
        .btn { 
            padding: 15px; border-radius: 15px; border: none; font-weight: 700; 
            cursor: pointer; width: 100%; transition: 0.2s; font-size: 0.9rem; margin-top: 10px;
        }
        .btn:active { transform: scale(0.98); }
        .btn-main { background: var(--primary); color: white; }
        .btn-danger { background: #ff4d6d; color: white; }
        .btn-emoji { font-size: 2.5rem; background: none; border: none; cursor: pointer; margin: 10px 20px; transition: 0.3s; }
        .btn-emoji:hover { transform: scale(1.2); }

        input, select, textarea { 
            width: 100%; padding: 14px; border-radius: 12px; border: 1px solid var(--border); 
            margin-bottom: 10px; font-family: inherit; font-size: 0.9rem; background: #fdfdfd;
        }
        
        .grid-evo { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 10px; }
        .evo-data { font-size: 0.8rem; color: var(--text-light); display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin-top: 10px; }
        .diff { font-weight: 800; padding: 2px 8px; border-radius: 8px; font-size: 0.75rem; }
        .sube { background: #ffe5e5; color: #ff4d4d; } 
        .baja { background: #e5f9e5; color: #22c55e; }

        .progress-container { background: rgba(0,0,0,0.05); border-radius: 15px; height: 10px; margin-bottom: 25px; overflow: hidden; }
        .progress-bar { background: var(--accent); height: 100%; transition: 0.6s cubic-bezier(0.17, 0.67, 0.83, 0.67); }
    </style>
</head>
<body>

<div id="pantalla-inicio">
    <h1 style="color:#4a1e4a; margin-bottom:5px;">MONOS FIT</h1>
    <p style="color:#8e7d8e; margin-top:0;">Bienvenido de nuevo</p>
    <input type="text" id="input-socio" placeholder="Ingresa N¬∞ Socio" style="max-width: 250px; text-align: center; border: 2px solid var(--primary);">
    <p style="font-weight:600; margin-top:20px;">Selecciona tu perfil:</p>
    <div style="display:flex;">
        <button class="btn-emoji" onclick="validarIngreso('ni√±a')">üå∏</button>
        <button class="btn-emoji" onclick="validarIngreso('ni√±o')">‚ö°</button>
    </div>
</div>

<header>
    <div id="socio-display">Socio: ---</div>
    <h1 id="titulo-header" style="margin:0; font-size: 1.5rem;">MI ENTRENAMIENTO</h1>
    <div id="status-dia" style="font-weight:300; opacity:0.9;">D√≠a 1</div>
</header>

<nav id="main-nav">
    <button class="active" data-section="entrenar"><span>üè†</span>HOY</button>
    <button data-section="rutina"><span>üìù</span>PLAN</button>
    <button data-section="dieta"><span>üçé</span>DIETA</button>
    <button data-section="suples"><span>üíä</span>SUPLES</button>
    <button data-section="progreso"><span>üìâ</span>EVO</button>
    <button data-section="ajustes"><span>‚öôÔ∏è</span>GEAR</button>
</nav>

<section id="entrenar" class="active">
    <div class="progress-container"><div id="bar" class="progress-bar" style="width: 0%"></div></div>
    <div id="listaEntrenamiento"></div>
</section>

<section id="rutina">
    <div class="card">
        <h3>‚ûï Nuevo Ejercicio</h3>
        <select id="r_dia"><option value="1">D√≠a 1</option><option value="2">D√≠a 2</option><option value="3">D√≠a 3</option><option value="4">D√≠a 4</option><option value="5">D√≠a 5</option><option value="6">D√≠a 6</option><option value="7">D√≠a 7</option></select>
        <input id="r_nombre" placeholder="Nombre del Ejercicio">
        <input id="r_series" placeholder="Series y Repeticiones (ej. 4x12)">
        <input type="file" id="r_file" accept="image/*" style="font-size:0.8rem;">
        <button class="btn btn-main" onclick="guardarEjercicio()">Guardar en Plan</button>
        <button class="btn btn-danger" style="margin-top:20px; opacity:0.8;" onclick="eliminarTodasRutinas()">üóëÔ∏è Limpiar Plan Mensual</button>
    </div>
    <div id="visor-plan-detallado"></div>
</section>

<section id="dieta">
    <div class="card">
        <h3>üç¥ Plan Alimenticio</h3>
        <select id="d_menu_sel" onchange="cargarFormDieta()">
            <option value="menuA">Men√∫ A (Opci√≥n 1)</option>
            <option value="menuB">Men√∫ B (Opci√≥n 2)</option>
        </select>
        <textarea id="d_des" placeholder="Desayuno" rows="2"></textarea>
        <textarea id="d_s1" placeholder="Snack 1" rows="2"></textarea>
        <textarea id="d_com" placeholder="Comida" rows="2"></textarea>
        <textarea id="d_s2" placeholder="Snack 2" rows="2"></textarea>
        <textarea id="d_cen" placeholder="Cena" rows="2"></textarea>
        <button class="btn btn-main" onclick="guardarDieta()">Actualizar Dieta</button>
    </div>
</section>

<section id="suples">
    <div class="card">
        <h3>üíä Suplementaci√≥n</h3>
        <input id="s_nombre" placeholder="Nombre del Suplemento">
        <input id="s_momento" placeholder="Instrucciones de toma">
        <button class="btn btn-main" onclick="agregarSuplemento()">A√±adir a la lista</button>
    </div>
    <div id="lista-suples"></div>
</section>

<section id="progreso">
    <div class="card">
        <h3>üìâ Registro de M√©tricas</h3>
        <div class="grid-evo">
            <input type="number" id="e_peso" placeholder="Peso (kg)" step="0.1">
            <input type="number" id="e_cintura" placeholder="Cintura (cm)">
            <input type="number" id="e_cadera" placeholder="Cadera (cm)">
            <input type="number" id="e_grasa" placeholder="% Grasa">
            <input type="number" id="e_musculo" placeholder="% M√∫sculo">
        </div>
        <button class="btn btn-main" onclick="registrarEvo()">Guardar y Comparar</button>
    </div>
    <div id="lista-evo"></div>
</section>

<section id="ajustes">
    <div class="card" style="text-align:center;">
        <h3>‚öôÔ∏è Centro de Datos</h3>
        <p style="font-size:0.8rem; color:var(--text-light);">Usa el backup para cambiar de celular sin perder nada.</p>
        <button class="btn btn-main" onclick="exportarData()">üì§ Generar Backup (.json)</button>
        <button class="btn" style="background:#22c55e; color:white;" onclick="document.getElementById('importInput').click()">üì• Importar Backup</button>
        <input type="file" id="importInput" style="display:none" onchange="importarData(event)">
        <hr style="margin:20px 0; opacity:0.1;">
        <button class="btn btn-danger" onclick="eliminarTodo()">‚ö†Ô∏è RESET TOTAL</button>
    </div>
</section>

<script>
// Base de datos con valores por defecto para evitar errores de importaci√≥n
let DB = { 
    tema: null, socio: "", diaActual: 1, 
    rutinas: { "1":[], "2":[], "3":[], "4":[], "5":[], "6":[], "7":[] }, 
    dieta: { menuA: {}, menuB: {} },
    suplementos: [], evo: []
};

function save() { localStorage.setItem('MONOS_FIT_V2', JSON.stringify(DB)); }

function load() {
    const data = localStorage.getItem('MONOS_FIT_V2');
    if(data) {
        try {
            const parsed = JSON.parse(data);
            // Mezclamos con DB inicial para asegurar que no falten propiedades nuevas
            DB = { ...DB, ...parsed };
            if(DB.tema && DB.socio) {
                aplicarTema(DB.tema);
                document.getElementById('pantalla-inicio').style.display = 'none';
            }
        } catch(e) { console.error("Error cargando datos", e); }
    }
}

function validarIngreso(t) {
    const s = document.getElementById('input-socio').value.trim();
    if(!s) return alert("Por favor, ingresa tu n√∫mero de socio.");
    DB.socio = s;
    DB.tema = t;
    aplicarTema(t);
    document.getElementById('pantalla-inicio').style.display = 'none';
    save();
}

function aplicarTema(t) {
    document.body.className = 'tema-' + t;
    document.getElementById('socio-display').innerText = "SOCIO: " + DB.socio;
    renderTodo();
}

function renderTodo() {
    renderEntrenamiento(); renderPlan(); renderSuples(); renderEvo(); renderDieta();
}

// --- RUTINAS ---
function guardarEjercicio() {
    const dia = document.getElementById('r_dia').value;
    const nombre = document.getElementById('r_nombre').value.trim();
    const series = document.getElementById('r_series').value.trim();
    const file = document.getElementById('r_file').files[0];
    
    if(!nombre) return alert("Escribe el nombre del ejercicio");

    const addEj = (imgData = "") => {
        DB.rutinas[dia].push({ nombre, series, img: imgData, done: false });
        save(); renderTodo();
        document.getElementById('r_nombre').value = "";
        document.getElementById('r_series').value = "";
        document.getElementById('r_file').value = "";
    };

    if(file) {
        const reader = new FileReader();
        reader.onload = (e) => addEj(e.target.result);
        reader.readAsDataURL(file);
    } else { addEj(); }
}

function eliminarTodasRutinas() {
    if(confirm("¬øSeguro? Se borrar√°n todos los ejercicios de todos los d√≠as.")) {
        DB.rutinas = { "1":[], "2":[], "3":[], "4":[], "5":[], "6":[], "7":[] };
        save(); renderTodo();
    }
}

function renderPlan() {
    const cont = document.getElementById('visor-plan-detallado');
    cont.innerHTML = "<h4 style='margin-left:10px;'>Lista del Mes</h4>";
    for(let d in DB.rutinas) {
        if(DB.rutinas[d].length > 0) {
            let html = `<div class='card'><b>D√çA ${d}</b><div style='margin-top:10px;'>`;
            DB.rutinas[d].forEach((ej, idx) => {
                html += `<div style='display:flex; justify-content:space-between; font-size:0.85rem; margin-bottom:5px; border-bottom:1px solid #eee; padding-bottom:5px;'>
                    <span>${ej.nombre}</span>
                    <span style='color:red; cursor:pointer;' onclick='DB.rutinas[${d}].splice(${idx},1);save();renderTodo();'>‚úï</span>
                </div>`;
            });
            html += `</div></div>`;
            cont.innerHTML += html;
        }
    }
}

// --- DIETA (FIXED) ---
function cargarFormDieta() {
    const sel = document.getElementById('d_menu_sel').value;
    const m = DB.dieta[sel] || {};
    document.getElementById('d_des').value = m.desayuno || "";
    document.getElementById('d_s1').value = m.snack1 || "";
    document.getElementById('d_com').value = m.comida || "";
    document.getElementById('d_s2').value = m.snack2 || "";
    document.getElementById('d_cen').value = m.cena || "";
}

function guardarDieta() {
    const sel = document.getElementById('d_menu_sel').value;
    DB.dieta[sel] = {
        desayuno: document.getElementById('d_des').value,
        snack1: document.getElementById('d_s1').value,
        comida: document.getElementById('d_com').value,
        snack2: document.getElementById('d_s2').value,
        cena: document.getElementById('d_cen').value
    };
    save(); alert("Dieta actualizada correctamente ‚úÖ");
}

function renderDieta() { cargarFormDieta(); }

// --- SUPLES ---
function agregarSuplemento() {
    const n = document.getElementById('s_nombre').value.trim();
    const m = document.getElementById('s_momento').value.trim();
    if(n) {
        DB.suplementos.push({ nombre: n, momento: m });
        save(); renderSuples();
        document.getElementById('s_nombre').value = "";
        document.getElementById('s_momento').value = "";
    }
}

function renderSuples() {
    document.getElementById('lista-suples').innerHTML = DB.suplementos.map((s, i) => `
    <div class="ex-card">
        <div style="flex:1"><b>${s.nombre}</b><br><small>${s.momento}</small></div>
        <button style="border:none; background:none; color:red; font-size:1.2rem;" onclick="DB.suplementos.splice(${i},1);save();renderSuples();">üóëÔ∏è</button>
    </div>`).join('');
}

// --- EVOLUCI√ìN ---
function registrarEvo() {
    const val = (id) => parseFloat(document.getElementById(id).value) || 0;
    const entry = {
        fecha: new Date().toLocaleDateString('es-MX', {day:'2-digit', month:'short'}),
        peso: val('e_peso'),
        cintura: val('e_cintura'),
        cadera: val('e_cadera'),
        grasa: val('e_grasa'),
        musculo: val('e_musculo')
    };
    if(entry.peso === 0) return alert("Ingresa al menos el peso");
    DB.evo.unshift(entry);
    save(); renderEvo();
    // Limpiar inputs
    ['e_peso','e_cintura','e_cadera','e_grasa','e_musculo'].forEach(i => document.getElementById(i).value = "");
}

function renderEvo() {
    const cont = document.getElementById('lista-evo');
    cont.innerHTML = DB.evo.map((e, i) => {
        let comp = "";
        const sig = DB.evo[i + 1];
        if(sig) {
            const dif = (e.peso - sig.peso).toFixed(1);
            comp = `<span class="diff ${dif > 0 ? 'sube' : 'baja'}">${dif > 0 ? '‚ñ≤' : ''}${dif} kg</span>`;
        }
        return `<div class="card">
            <div style="display:flex; justify-content:space-between; align-items:center;">
                <b style="color:var(--primary)">${e.fecha}</b> ${comp}
            </div>
            <div class="evo-data">
                <span>Peso: <b>${e.peso}kg</b></span> <span>Cint: ${e.cintura}cm</span>
                <span>Grasa: ${e.grasa}%</span> <span>Musc: ${e.musculo}%</span>
            </div>
        </div>`;
    }).join('');
}

// --- HOY ---
function renderEntrenamiento() {
    const cont = document.getElementById('listaEntrenamiento');
    const ejercicios = DB.rutinas[DB.diaActual.toString()] || [];
    let completados = 0;
    
    cont.innerHTML = `<h2 style="margin-top:0;">D√≠a ${DB.diaActual}</h2>`;
    
    if(ejercicios.length === 0) {
        cont.innerHTML += `<p style="text-align:center; opacity:0.5; margin-top:40px;">No hay ejercicios para hoy.<br>Agr√©galos en la pesta√±a PLAN.</p>`;
    }

    ejercicios.forEach((ej, idx) => {
        if(ej.done) completados++;
        cont.innerHTML += `<div class="ex-card" style="${ej.done ? 'opacity:0.6; background:#f9f9f9;' : ''}">
            <img src="${ej.img || 'https://via.placeholder.com/60?text=FIT'}" class="ex-img">
            <div style="flex:1"><b>${ej.nombre}</b><br><small>${ej.series}</small></div>
            <input type="checkbox" style="width:28px; height:28px; accent-color:var(--primary);" ${ej.done?'checked':''} 
                onchange="DB.rutinas[${DB.diaActual}][${idx}].done=!DB.rutinas[${DB.diaActual}][${idx}].done;save();renderEntrenamiento();">
        </div>`;
    });
    
    const p = ejercicios.length ? (completados / ejercicios.length) * 100 : 0;
    document.getElementById('bar').style.width = p + "%";
    document.getElementById('status-dia').innerText = `Progreso: ${Math.round(p)}%`;
}

// --- GEAR & BACKUP ---
function exportarData() {
    const blob = new Blob([JSON.stringify(DB)], {type:'application/json'});
    const a = document.createElement('a'); 
    a.href = URL.createObjectURL(blob);
    a.download = `monosfit_backup_${DB.socio}.json`; 
    a.click();
}

function importarData(e) {
    const r = new FileReader();
    r.onload = (ev) => { 
        try {
            const tempDB = JSON.parse(ev.target.result);
            // Aseguramos que el socio y el tema existan para no romper el inicio
            if(tempDB.socio && tempDB.tema) {
                DB = tempDB;
                save();
                alert("Importaci√≥n exitosa. Reiniciando...");
                location.reload(); 
            } else {
                alert("Archivo de backup no v√°lido.");
            }
        } catch(err) {
            alert("Error al leer el archivo.");
        }
    };
    r.readAsText(e.target.files[0]);
}

function eliminarTodo() {
    if(confirm("¬°ATENCI√ìN! Se borrar√°n todos los datos, incluyendo socio y progresos. ¬øContinuar?")) {
        localStorage.clear();
        location.reload();
    }
}

// Navegaci√≥n
document.querySelectorAll('nav button').forEach(btn => {
    btn.addEventListener('click', () => {
        document.querySelectorAll('nav button').forEach(b => b.classList.remove('active'));
        document.querySelectorAll('section').forEach(s => s.classList.remove('active'));
        btn.classList.add('active');
        document.getElementById(btn.dataset.section).classList.add('active');
        window.scrollTo(0,0);
    });
});

load();
</script>
</body>
</html>
