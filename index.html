<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MONOS FIT | Pink & Magic</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap');

        :root {
            --primary: #9d4edd; 
            --primary-light: #e0aaff;
            --accent: #ff85a1; 
            --bg: #fff5f8; 
            --card: #ffffff;
            --text: #4a1e4a; 
            --text-light: #8e7d8e;
            --shadow: 0 10px 30px rgba(157, 78, 221, 0.1);
            --radius: 24px;
        }

        body {
            margin: 0;
            font-family: 'Poppins', sans-serif;
            background-color: var(--bg);
            color: var(--text);
            padding-bottom: 80px;
        }

        /* --- Header --- */
        header {
            padding: 50px 20px;
            text-align: center;
            background: linear-gradient(135deg, #fbc2eb 0%, #a6c1ee 100%);
            color: white;
            border-bottom-left-radius: 40px; border-bottom-right-radius: 40px;
            box-shadow: var(--shadow);
        }
        header h1 { margin: 0; font-size: 2.2rem; font-weight: 700; }
        #frase-container { margin-top: 10px; font-weight: 300; font-size: 0.9rem; }

        /* --- Nav Glassmorphism --- */
        nav {
            display: flex;
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(15px);
            position: sticky; top: 0; z-index: 1000;
            border-bottom: 1px solid rgba(255,255,255,0.3);
            justify-content: space-around;
        }
        nav button {
            border: none; background: none; padding: 18px 10px;
            font-weight: 600; font-size: 0.8rem; color: var(--text-light); cursor: pointer;
        }
        nav button.active { color: var(--primary); border-bottom: 3px solid var(--primary); }

        /* --- Layout --- */
        section { display: none; max-width: 600px; margin: 30px auto; padding: 0 20px; animation: fadeIn 0.5s ease; }
        section.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        .card {
            background: var(--card);
            border-radius: var(--radius);
            padding: 25px; margin-bottom: 25px;
            box-shadow: var(--shadow);
            border: 1px solid rgba(255, 255, 255, 0.5);
        }

        /* --- Entrenamiento (Sin contracci√≥n) --- */
        .ex-card {
            display: flex; align-items: center; gap: 15px; padding: 15px;
            background: #fff; border-radius: 18px; margin-bottom: 12px;
            border: 1px solid #f0e6f0;
        }
        .ex-img { width: 65px; height: 65px; border-radius: 15px; object-fit: cover; background: #fafafa; }
        
        /* --- Inputs & Buttons --- */
        input, select {
            width: 100%; padding: 12px 15px; border-radius: 15px; border: 2px solid #f0e6f0;
            margin-bottom: 15px; box-sizing: border-box; font-family: inherit;
        }

        .btn {
            padding: 14px; border-radius: 18px; border: none; font-weight: 600;
            cursor: pointer; transition: 0.3s; font-family: inherit;
        }
        .btn-main { background: linear-gradient(135deg, var(--primary), #7b2cbf); color: white; width: 100%; }
        .btn-pink { background: var(--accent); color: white; width: 100%; }

        #timer-box {
            position: fixed; bottom: 25px; right: 25px; background: white;
            border: 2px solid var(--primary-light); padding: 15px 25px;
            border-radius: 50px; font-weight: 700; color: var(--primary);
            box-shadow: var(--shadow); display: none; z-index: 2000;
        }
    </style>
</head>
<body>

<header>
    <h1>MONOS FIT üå∏</h1>
    <div id="frase-container">Cargando inspiraci√≥n...</div>
</header>

<nav>
    <button class="active" data-section="entrenar">HOY</button>
    <button data-section="rutina">PLAN</button>
    <button data-section="dieta">DIETA</button>
    <button data-section="progreso">EVO</button>
    <button data-section="ajustes">GEAR</button>
</nav>

<section id="entrenar" class="active">
    <h2>‚ú® Rutina de Hoy</h2>
    <select id="selectDiaHoy" onchange="renderEntrenamiento()">
        <option value="1">Lunes - D√≠a 1</option><option value="2">Martes - D√≠a 2</option>
        <option value="3">Mi√©rcoles - D√≠a 3</option><option value="4">Jueves - D√≠a 4</option>
        <option value="5">Viernes - D√≠a 5</option><option value="6">S√°bado - D√≠a 6</option>
    </select>
    <div id="listaEntrenamiento" style="margin-top:15px"></div>
</section>

<section id="rutina">
    <div class="card">
        <h2>üìù A√±adir Ejercicio</h2>
        <select id="r_dia"><option value="1">D√≠a 1</option><option value="2">D√≠a 2</option><option value="3">D√≠a 3</option><option value="4">D√≠a 4</option><option value="5">D√≠a 5</option><option value="6">D√≠a 6</option></select>
        <input id="r_nombre" placeholder="Nombre (ej. Sentadillas)">
        <input id="r_series" placeholder="Series/Reps (ej. 4x10)">
        <input type="file" id="r_file" accept="image/*">
        <button class="btn btn-main" onclick="agregarEjercicio()">Guardar Ejercicio</button>
    </div>
</section>

<section id="dieta">
    <div class="card">
        <h2>‚öñÔ∏è Macros</h2>
        <input type="number" id="m_peso" placeholder="Peso actual (kg)">
        <button class="btn btn-main" onclick="calcularMacros()">Calcular</button>
        <div id="macro-res" style="display:flex; gap:10px; margin-top:15px"></div>
    </div>
    <div id="menuHoyBox"></div>
    <div class="card">
        <h2>üç≥ Men√∫s Base</h2>
        <div style="display:flex; gap:5px; margin-bottom:10px">
            <button class="btn" style="flex:1" onclick="tabDieta('A')">Men√∫ A</button>
            <button class="btn" style="flex:1" onclick="tabDieta('B')">Men√∫ B</button>
        </div>
        <input id="in_des" placeholder="Desayuno">
        <input id="in_co" placeholder="Almuerzo">
        <input id="in_ce" placeholder="Cena">
        <button class="btn btn-pink" onclick="guardarDieta()">Guardar Men√∫</button>
    </div>
</section>

<section id="progreso">
    <div class="card">
        <h2>üìâ Registro</h2>
        <input type="number" id="ev_peso" placeholder="Peso (kg)">
        <input type="number" id="ev_cintura" placeholder="Cintura (cm)">
        <button class="btn btn-main" onclick="guardarProgreso()">Registrar</button>
    </div>
    <div id="historial-lista"></div>
</section>

<section id="ajustes">
    <div class="card">
        <h2>‚öôÔ∏è Gesti√≥n de Datos</h2>
        <p style="font-size:0.8rem; color:var(--text-light)">Como los navegadores protegen tus archivos, debes seleccionar el archivo manualmente, pero se cargar√° al instante.</p>
        <button class="btn btn-main" style="margin-bottom:10px" onclick="exportarData()">üì§ Exportar Backup</button>
        <button class="btn btn-pink" onclick="document.getElementById('importInput').click()">üì• Importar Backup</button>
        <input type="file" id="importInput" style="display:none" onchange="importarData(event)">
        <hr style="margin:20px 0; border:0; border-top:1px solid #f0e6f0">
        <button class="btn" style="width:100%; background:#ffccd5; color:#c9184a" onclick="resetData()">Eliminar todo</button>
    </div>
</section>

<div id="timer-box">‚è±Ô∏è <span id="time">60</span>s</div>

<script>
let DB = {
    rutinas: { "1": [], "2": [], "3": [], "4": [], "5": [], "6": [] },
    dieta: { menuA: {}, menuB: {}, plan: {} },
    progreso: []
};

// --- CORE ---
function save() { localStorage.setItem('MONOS_FIT_PINK_V3', JSON.stringify(DB)); }
function load() {
    const data = localStorage.getItem('MONOS_FIT_PINK_V3');
    if(data) DB = JSON.parse(data);
    else { for(let i=1; i<=28; i++) DB.dieta.plan[i] = (i%2===0)?'B':'A'; save(); }
}

const frases = ["¬°Tu esfuerzo hoy dar√° frutos ma√±ana!", "La disciplina es amor propio.", "S√© tu propia motivaci√≥n.", "El rosa es poder.", "Entrenar cambia el humor."];
function mostrarFrase() { document.getElementById('frase-container').innerText = frases[Math.floor(Math.random()*frases.length)]; }

// --- NAVEGACI√ìN ---
document.querySelectorAll('nav button').forEach(btn => {
    btn.addEventListener('click', () => {
        document.querySelectorAll('nav button').forEach(b => b.classList.remove('active'));
        document.querySelectorAll('section').forEach(s => s.classList.remove('active'));
        btn.classList.add('active');
        document.getElementById(btn.dataset.section).classList.add('active');
        if(btn.dataset.section === 'entrenar') renderEntrenamiento();
        if(btn.dataset.section === 'dieta') renderDieta();
        if(btn.dataset.section === 'progreso') renderProgreso();
    });
});

// --- ENTRENAMIENTO (FUNCIONALIDAD MEJORADA) ---
function renderEntrenamiento() {
    const dia = document.getElementById('selectDiaHoy').value;
    const cont = document.getElementById('listaEntrenamiento');
    cont.innerHTML = '';
    
    if (DB.rutinas[dia].length === 0) {
        cont.innerHTML = '<p style="text-align:center; color:var(--text-light)">A√∫n no tienes ejercicios en el PLAN.</p>';
        return;
    }

    DB.rutinas[dia].forEach((ej, idx) => {
        const div = document.createElement('div');
        div.className = 'ex-card';
        div.innerHTML = `
            <img src="${ej.img}" class="ex-img" onerror="this.style.display='none'">
            <div style="flex:1">
                <div style="font-weight:600">${ej.nombre}</div>
                <div style="font-size:0.75rem; color:var(--text-light)">${ej.series}</div>
            </div>
            <input type="checkbox" style="width:25px; height:25px; accent-color:var(--primary)" ${ej.done?'checked':''} onchange="toggleEj(${dia}, ${idx})">
        `;
        cont.appendChild(div);
    });
}

function toggleEj(dia, idx) {
    DB.rutinas[dia][idx].done = !DB.rutinas[dia][idx].done;
    if(DB.rutinas[dia][idx].done) startTimer();
    save();
    // NOTA: No llamamos a renderEntrenamiento() aqu√≠ para evitar que la lista "salte" o se contraiga.
}

function startTimer() {
    const box = document.getElementById('timer-box');
    const time = document.getElementById('time');
    let s = 60; box.style.display = 'block';
    const inv = setInterval(() => {
        s--; time.innerText = s;
        if(s <= 0) { clearInterval(inv); box.style.display = 'none'; }
    }, 1000);
}

// --- RESTO DE FUNCIONES ---
function agregarEjercicio() {
    const dia = document.getElementById('r_dia').value;
    const nombre = document.getElementById('r_nombre').value;
    const series = document.getElementById('r_series').value;
    const file = document.getElementById('r_file').files[0];
    if(!nombre) return alert("¬°Falta el nombre!");
    const reader = new FileReader();
    reader.onload = (e) => {
        DB.rutinas[dia].push({ nombre, series, img: e.target.result || '', done: false });
        save(); alert("¬°Guardado!");
        document.getElementById('r_nombre').value = '';
    };
    if(file) reader.readAsDataURL(file); else reader.onload({});
}

function calcularMacros() {
    const peso = document.getElementById('m_peso').value;
    if(!peso) return;
    const p = peso * 2; const f = peso * 0.8;
    document.getElementById('macro-res').innerHTML = `
        <div style="flex:1; background:var(--primary); color:white; padding:10px; border-radius:10px; text-align:center"><b>${Math.round(p)}g</b><br>Prot</div>
        <div style="flex:1; background:var(--accent); color:white; padding:10px; border-radius:10px; text-align:center"><b>${Math.round(f)}g</b><br>Grasa</div>
    `;
}

function renderDieta() {
    const hoy = ((new Date().getDate()-1)%28)+1;
    const m = DB.dieta[`menu${DB.dieta.plan[hoy]}`];
    document.getElementById('menuHoyBox').innerHTML = `<div class="card"><h2>üå∏ Hoy (D√≠a ${hoy})</h2><p>${m.des || 'Sin desayuno'}<br>${m.co || 'Sin comida'}<br>${m.ce || 'Sin cena'}</p></div>`;
}

let dTab = 'A';
function tabDieta(t) { dTab = t; const m = DB.dieta[`menu${t}`]; document.getElementById('in_des').value = m.des||''; document.getElementById('in_co').value = m.co||''; document.getElementById('in_ce').value = m.ce||''; }
function guardarDieta() { DB.dieta[`menu${dTab}`] = { des: document.getElementById('in_des').value, co: document.getElementById('in_co').value, ce: document.getElementById('in_ce').value }; save(); renderDieta(); alert("Men√∫ guardado"); }

function guardarProgreso() {
    const peso = document.getElementById('ev_peso').value;
    const cint = document.getElementById('ev_cintura').value;
    if(!peso) return;
    DB.progreso.unshift({ fecha: new Date().toLocaleDateString(), peso, cint });
    save(); renderProgreso();
}

function renderProgreso() {
    const cont = document.getElementById('historial-lista');
    cont.innerHTML = '';
    DB.progreso.forEach((p, i) => {
        cont.innerHTML += `<div class="card" style="display:flex; justify-content:space-between"><div><b>${p.fecha}</b>: ${p.peso}kg</div><button onclick="borrarP(${i})">üóëÔ∏è</button></div>`;
    });
}
function borrarP(i) { DB.progreso.splice(i,1); save(); renderProgreso(); }

function exportarData() {
    const blob = new Blob([JSON.stringify(DB)], {type: 'application/json'});
    const a = document.createElement('a'); a.href = URL.createObjectURL(blob);
    a.download = 'backup_fit.json'; a.click();
}

function importarData(e) {
    const file = e.target.files[0];
    if (!file) return;
    const reader = new FileReader();
    reader.onload = (ev) => {
        try {
            DB = JSON.parse(ev.target.result);
            save();
            alert("‚ú® ¬°Datos recuperados con √©xito!");
            location.reload();
        } catch(err) { alert("Archivo no v√°lido"); }
    };
    reader.readAsText(file);
}

function resetData() { if(confirm("¬øBorrar todo?")) { localStorage.clear(); location.reload(); } }

// INIT
load(); mostrarFrase(); renderEntrenamiento();
</script>
</body>
</html>
