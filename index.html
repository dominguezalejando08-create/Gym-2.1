<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MONOS FIT | Auto-Flow</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap');

        :root {
            --primary: #9d4edd; --accent: #ff85a1; --bg: #fff5f8; --card: #ffffff;
            --text: #4a1e4a; --text-light: #8e7d8e; --shadow: 0 10px 30px rgba(0,0,0,0.05);
            --radius: 24px; --border: rgba(0,0,0,0.05);
        }

        .tema-ni√±a {
            --primary: #9d4edd; --accent: #ff85a1; --bg: #fff5f8; --gradient: linear-gradient(135deg, #fbc2eb 0%, #a6c1ee 100%);
        }

        .tema-ni√±o {
            --primary: #2563eb; --accent: #22c55e; --bg: #f1f5f9; --text: #0f172a;
            --text-light: #64748b; --gradient: linear-gradient(135deg, #3b82f6 0%, #22c55e 100%);
            --border: rgba(0,0,0,0.1);
        }

        body { margin: 0; font-family: 'Poppins', sans-serif; background-color: var(--bg); color: var(--text); padding-bottom: 80px; transition: 0.3s; }

        #pantalla-inicio { position: fixed; inset: 0; background: #fff; z-index: 9999; display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 20px; text-align: center; }
        .btn-selector { padding: 20px 40px; margin: 10px; border-radius: 20px; border: none; font-size: 1.2rem; font-weight: 700; cursor: pointer; width: 250px; color: white; transition: 0.2s; }

        header { padding: 40px 20px; text-align: center; background: var(--gradient); color: white; border-bottom-left-radius: 40px; border-bottom-right-radius: 40px; box-shadow: var(--shadow); }
        
        nav { display: flex; background: rgba(255, 255, 255, 0.8); backdrop-filter: blur(15px); position: sticky; top: 0; z-index: 1000; justify-content: space-around; border-bottom: 1px solid rgba(0,0,0,0.05); }
        nav button { border: none; background: none; padding: 18px 10px; font-weight: 600; font-size: 0.8rem; color: var(--text-light); cursor: pointer; }
        nav button.active { color: var(--primary); border-bottom: 3px solid var(--primary); }

        section { display: none; max-width: 600px; margin: 20px auto; padding: 0 20px; animation: fadeIn 0.4s; }
        section.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        .card { background: var(--card); border-radius: var(--radius); padding: 20px; margin-bottom: 20px; box-shadow: var(--shadow); border: 1px solid var(--border); }
        
        /* Barra de Progreso */
        .progress-container { background: #eee; border-radius: 10px; height: 10px; margin: 10px 0 20px 0; overflow: hidden; }
        .progress-bar { background: var(--accent); height: 100%; width: 0%; transition: 0.5s; }

        .ex-card { display: flex; align-items: center; gap: 15px; padding: 15px; background: var(--card); border-radius: 18px; margin-bottom: 12px; border: 1px solid var(--border); }
        .ex-img { width: 60px; height: 60px; border-radius: 12px; object-fit: cover; background: #eee; }

        .btn { padding: 14px; border-radius: 18px; border: none; font-weight: 600; cursor: pointer; width: 100%; transition: 0.2s; }
        .btn-main { background: var(--primary); color: white; }
        .btn-accent { background: var(--accent); color: white; }

        input, select { width: 100%; padding: 12px; border-radius: 15px; border: 2px solid var(--border); margin-bottom: 15px; box-sizing: border-box; background: var(--card); color: var(--text); font-family: inherit; }

        #timer-box { position: fixed; bottom: 25px; right: 25px; background: var(--card); border: 2px solid var(--primary); padding: 15px 25px; border-radius: 50px; font-weight: 700; color: var(--primary); display: none; box-shadow: var(--shadow); z-index: 2000; }
    </style>
</head>
<body class="tema-ni√±a">

<div id="pantalla-inicio">
    <h1>üêµ MONOS FIT</h1>
    <p>Selecciona tu estilo:</p>
    <button class="btn-selector" style="background:#ff85a1" onclick="elegirTema('ni√±a')">Ni√±a üå∏</button>
    <button class="btn-selector" style="background:#2563eb" onclick="elegirTema('ni√±o')">Ni√±o ‚ö°</button>
</div>

<header>
    <h1 id="titulo-header">MI RUTINA</h1>
    <div id="status-dia">D√≠a 1 - ¬°A por ello!</div>
</header>

<nav>
    <button class="active" data-section="entrenar">HOY</button>
    <button data-section="rutina">PLAN</button>
    <button data-section="dieta">DIETA</button>
    <button data-section="progreso">EVO</button>
    <button data-section="ajustes">GEAR</button>
</nav>

<section id="entrenar" class="active">
    <div class="progress-container"><div id="bar" class="progress-bar"></div></div>
    <div id="listaEntrenamiento"></div>
    <button id="btn-reset-dia" class="btn btn-accent" style="margin-top:20px; display:none;" onclick="reiniciarRutinaManual()">Reiniciar D√≠a</button>
</section>

<section id="rutina">
    <div class="card">
        <h2>üìù Configurar Rutinas</h2>
        <select id="r_dia">
            <option value="1">D√≠a 1</option>
            <option value="2">D√≠a 2</option>
        </select>
        <input id="r_nombre" placeholder="Nombre del ejercicio">
        <input id="r_series" placeholder="Series / Reps">
        <input type="file" id="r_file" accept="image/*">
        <button class="btn btn-main" onclick="agregarEjercicio()">A√±adir al Plan</button>
    </div>
</section>

<section id="dieta"><div class="card"><h2>üç¥ Men√∫</h2><input id="in_des" placeholder="Cena/Comida"><button class="btn btn-main" onclick="alert('Guardado')">Guardar</button></div></section>
<section id="progreso"><div class="card"><h2>üìâ Peso</h2><input type="number" id="ev_peso"><button class="btn btn-main" onclick="alert('Registrado')">Registrar</button></div></section>

<section id="ajustes">
    <div class="card">
        <h2>‚öôÔ∏è Ajustes</h2>
        <button class="btn btn-main" onclick="exportarData()">üì§ Backup</button>
        <button class="btn btn-accent" style="margin-top:10px" onclick="reiniciarPerfil()">üîÑ Cambiar Ni√±o/Ni√±a</button>
        <button class="btn" style="margin-top:10px; background:#ef4444; color:white" onclick="resetData()">üóëÔ∏è Borrar Todo</button>
    </div>
</section>

<div id="timer-box">‚è±Ô∏è <span id="time">60</span>s</div>

<script>
let DB = {
    tema: null,
    diaActual: 1, // Controla si estamos en el 1 o el 2
    rutinas: { "1": [], "2": [] }
};

function save() { localStorage.setItem('MONOS_FIT_AUTO', JSON.stringify(DB)); }
function load() {
    const data = localStorage.getItem('MONOS_FIT_AUTO');
    if(data) {
        DB = JSON.parse(data);
        if(DB.tema) aplicarTema(DB.tema);
    }
}

function elegirTema(t) { DB.tema = t; aplicarTema(t); save(); }
function aplicarTema(t) {
    document.body.className = 'tema-' + t;
    document.getElementById('pantalla-inicio').style.display = 'none';
    document.getElementById('titulo-header').innerText = t === 'ni√±a' ? 'MONOS FIT üå∏' : 'MONOS FIT ‚ö°';
    renderEntrenamiento();
}

function renderEntrenamiento() {
    const cont = document.getElementById('listaEntrenamiento');
    const status = document.getElementById('status-dia');
    const bar = document.getElementById('bar');
    const btnReset = document.getElementById('btn-reset-dia');
    
    let dia = DB.diaActual;
    let ejercicios = DB.rutinas[dia] || [];
    
    cont.innerHTML = '';
    
    if(ejercicios.length === 0) {
        cont.innerHTML = `<p style="text-align:center">No hay ejercicios en el D√≠a ${dia}. Agr√©galos en "PLAN".</p>`;
        status.innerText = `D√≠a ${dia} - Vac√≠o`;
        bar.style.width = "0%";
        return;
    }

    let completados = 0;
    ejercicios.forEach((ej, idx) => {
        if(ej.done) completados++;
        const div = document.createElement('div');
        div.className = 'ex-card';
        div.innerHTML = `
            <img src="${ej.img}" class="ex-img" onerror="this.style.display='none'">
            <div style="flex:1">
                <div style="font-weight:600">${ej.nombre}</div>
                <div style="font-size:0.75rem; color:var(--text-light)">${ej.series}</div>
            </div>
            <input type="checkbox" style="width:25px; height:25px" ${ej.done?'checked':''} onchange="completarEj(${idx})">
        `;
        cont.appendChild(div);
    });

    const porcentaje = (completados / ejercicios.length) * 100;
    bar.style.width = porcentaje + "%";
    status.innerText = `D√≠a ${dia} - ${Math.round(porcentaje)}% completado`;
    btnReset.style.display = "block";

    // L√ìGICA AUTOM√ÅTICA: Si llega al 100%
    if(porcentaje === 100) {
        setTimeout(() => {
            if(DB.diaActual === 1) {
                alert("¬°Felicidades! D√≠a 1 terminado. Pasando al D√≠a 2...");
                DB.diaActual = 2;
                save();
                renderEntrenamiento();
            } else {
                alert("¬°Has completado el ciclo! Reiniciando al D√≠a 1.");
                reiniciarRutinaManual();
            }
        }, 800);
    }
}

function completarEj(idx) {
    DB.rutinas[DB.diaActual][idx].done = !DB.rutinas[DB.diaActual][idx].done;
    if(DB.rutinas[DB.diaActual][idx].done) startTimer();
    save();
    renderEntrenamiento(); // Aqu√≠ s√≠ refrescamos para la barra de progreso y el cambio de d√≠a
}

function reiniciarRutinaManual() {
    // Ponemos todos los ejercicios de ambos d√≠as como no hechos
    [1, 2].forEach(d => {
        DB.rutinas[d].forEach(ej => ej.done = false);
    });
    DB.diaActual = 1;
    save();
    renderEntrenamiento();
}

function startTimer() {
    const box = document.getElementById('timer-box');
    const time = document.getElementById('time');
    let s = 60; box.style.display = 'block';
    const inv = setInterval(() => {
        s--; time.innerText = s;
        if(s <= 0) { clearInterval(inv); box.style.display = 'none'; }
    }, 1000);
}

function agregarEjercicio() {
    const dia = document.getElementById('r_dia').value;
    const nombre = document.getElementById('r_nombre').value;
    const series = document.getElementById('r_series').value;
    const file = document.getElementById('r_file').files[0];
    if(!nombre) return alert("Falta nombre");
    const reader = new FileReader();
    reader.onload = (e) => {
        DB.rutinas[dia].push({ nombre, series, img: e.target.result || '', done: false });
        save(); alert("A√±adido!");
        document.getElementById('r_nombre').value = '';
    };
    if(file) reader.readAsDataURL(file); else reader.onload({});
}

// --- Navegaci√≥n ---
document.querySelectorAll('nav button').forEach(btn => {
    btn.addEventListener('click', () => {
        document.querySelectorAll('nav button').forEach(b => b.classList.remove('active'));
        document.querySelectorAll('section').forEach(s => s.classList.remove('active'));
        btn.classList.add('active');
        document.getElementById(btn.dataset.section).classList.add('active');
        if(btn.dataset.section === 'entrenar') renderEntrenamiento();
    });
});

function reiniciarPerfil() { localStorage.clear(); location.reload(); }
function resetData() { if(confirm("¬øBorrar todo?")) { localStorage.clear(); location.reload(); } }
function exportarData() { const blob = new Blob([JSON.stringify(DB)], {type:'application/json'}); const a = document.createElement('a'); a.href = URL.createObjectURL(blob); a.download = 'backup_fit.json'; a.click(); }

load();
</script>
</body>
</html>
