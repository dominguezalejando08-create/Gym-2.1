<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MONOS FIT | Gesti√≥n Total</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap');

        :root {
            --primary: #9d4edd; --accent: #ff85a1; --bg: #fff5f8; --card: #ffffff;
            --text: #4a1e4a; --text-light: #8e7d8e; --shadow: 0 10px 30px rgba(0,0,0,0.05);
            --radius: 24px; --border: rgba(0,0,0,0.05);
        }

        .tema-ni√±a { --primary: #9d4edd; --accent: #ff85a1; --bg: #fff5f8; --gradient: linear-gradient(135deg, #fbc2eb 0%, #a6c1ee 100%); }
        .tema-ni√±o { --primary: #2563eb; --accent: #22c55e; --bg: #f1f5f9; --text: #0f172a; --text-light: #64748b; --gradient: linear-gradient(135deg, #3b82f6 0%, #22c55e 100%); --border: rgba(0,0,0,0.1); }

        body { margin: 0; font-family: 'Poppins', sans-serif; background-color: var(--bg); color: var(--text); padding-bottom: 110px; transition: 0.3s; }

        #pantalla-inicio { position: fixed; inset: 0; background: #fff; z-index: 9999; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        .btn-emoji { font-size: 4rem; border: none; cursor: pointer; background: white; border-radius: 50%; width: 120px; height: 120px; margin: 15px; transition: 0.3s; box-shadow: 0 10px 20px rgba(0,0,0,0.1); display: flex; align-items: center; justify-content: center; border: 4px solid var(--border); }

        header { padding: 40px 20px; text-align: center; background: var(--gradient); color: white; border-bottom-left-radius: 40px; border-bottom-right-radius: 40px; }
        
        nav { display: flex; background: rgba(255, 255, 255, 0.9); backdrop-filter: blur(15px); position: fixed; bottom: 0; width: 100%; z-index: 1000; justify-content: space-around; border-top: 1px solid rgba(0,0,0,0.05); padding: 8px 0; }
        nav button { border: none; background: none; padding: 5px; font-weight: 600; font-size: 0.65rem; color: var(--text-light); cursor: pointer; display: flex; flex-direction: column; align-items: center; flex: 1; }
        nav button.active { color: var(--primary); }

        section { display: none; max-width: 600px; margin: 20px auto; padding: 0 15px; animation: fadeIn 0.4s; }
        section.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        .card { background: var(--card); border-radius: var(--radius); padding: 20px; margin-bottom: 20px; box-shadow: var(--shadow); border: 1px solid var(--border); }
        .ex-card { display: flex; align-items: center; gap: 12px; padding: 12px; background: var(--card); border-radius: 18px; margin-bottom: 10px; border: 1px solid var(--border); position: relative; }
        .ex-img { width: 60px; height: 60px; border-radius: 10px; object-fit: cover; background: #eee; }
        
        .btn { padding: 14px; border-radius: 18px; border: none; font-weight: 600; cursor: pointer; width: 100%; transition: 0.2s; margin-top: 10px; }
        .btn-main { background: var(--primary); color: white; }
        .btn-del { background: #ff4d4d; color: white; border-radius: 10px; padding: 5px 10px; font-size: 0.7rem; border: none; cursor: pointer; }
        .btn-edit { background: #ffb703; color: white; border-radius: 10px; padding: 5px 10px; font-size: 0.7rem; border: none; cursor: pointer; margin-right: 5px; }

        .progress-container { background: rgba(0,0,0,0.05); border-radius: 10px; height: 12px; margin-bottom: 20px; overflow: hidden; }
        .progress-bar { background: var(--accent); height: 100%; width: 0%; transition: 0.5s; }

        input, select, textarea { width: 100%; padding: 12px; border-radius: 15px; border: 2px solid var(--border); margin-bottom: 8px; box-sizing: border-box; font-family: inherit; }
        h4 { margin: 15px 0 10px 5px; color: var(--primary); border-left: 4px solid var(--primary); padding-left: 10px; }
    </style>
</head>
<body>

<div id="pantalla-inicio">
    <h1 style="color:#4a1e4a">MONOS FIT</h1>
    <div style="display:flex;">
        <button class="btn-emoji" onclick="elegirTema('ni√±a')">üå∏</button>
        <button class="btn-emoji" onclick="elegirTema('ni√±o')">‚ö°</button>
    </div>
</div>

<header>
    <h1 id="titulo-header">MI RUTINA</h1>
    <div id="status-dia">D√≠a 1</div>
    <div id="frase-dinamica">¬°A darle!</div>
</header>

<nav>
    <button class="active" data-section="entrenar"><span>üè†</span>HOY</button>
    <button data-section="rutina"><span>üìù</span>PLAN</button>
    <button data-section="dieta"><span>üçé</span>DIETA</button>
    <button data-section="suples"><span>üíä</span>SUPLES</button>
    <button data-section="progreso"><span>üìâ</span>EVO</button>
    <button data-section="ajustes"><span>‚öôÔ∏è</span>GEAR</button>
</nav>

<section id="entrenar" class="active">
    <div class="progress-container"><div id="bar" class="progress-bar"></div></div>
    <div id="listaEntrenamiento"></div>
</section>

<section id="rutina">
    <div class="card">
        <h3 id="form-title">üìù Agregar/Editar Ejercicio</h3>
        <input type="hidden" id="edit_index" value="-1">
        <select id="r_dia">
            <option value="1">D√≠a 1</option><option value="2">D√≠a 2</option>
            <option value="3">D√≠a 3</option><option value="4">D√≠a 4</option>
            <option value="5">D√≠a 5</option><option value="6">D√≠a 6</option>
            <option value="7">D√≠a 7</option>
        </select>
        <input id="r_nombre" placeholder="Nombre Ejercicio">
        <input id="r_series" placeholder="Series/Repeticiones">
        <label style="font-size: 0.7rem; color: gray;">Opcional: Cambiar foto</label>
        <input type="file" id="r_file" accept="image/*">
        <button class="btn btn-main" onclick="guardarEjercicio()">Guardar en el Plan</button>
        <button id="btn-cancel-edit" class="btn" style="display:none; background:#ccc;" onclick="cancelarEdicion()">Cancelar Edici√≥n</button>
    </div>

    <div id="visor-plan-detallado">
        </div>
</section>

<section id="dieta">
    <div class="card">
        <h3>üç¥ Editor de Dieta</h3>
        <select id="d_menu_sel" onchange="cargarFormDieta()">
            <option value="menuA">Men√∫ A</option>
            <option value="menuB">Men√∫ B</option>
        </select>
        <textarea id="d_des" placeholder="Desayuno..."></textarea>
        <textarea id="d_s1" placeholder="Snack 1..."></textarea>
        <textarea id="d_com" placeholder="Comida..."></textarea>
        <textarea id="d_s2" placeholder="Snack 2..."></textarea>
        <textarea id="d_cen" placeholder="Cena..."></textarea>
        <button class="btn btn-main" onclick="guardarDieta()">Guardar Dieta</button>
    </div>
</section>

<section id="suples">
    <div class="card">
        <h3>üíä Mis Suplementos</h3>
        <input id="s_nombre" placeholder="Nombre (ej. Creatina)">
        <input id="s_momento" placeholder="Horario (ej. Ayunas)">
        <button class="btn btn-main" onclick="agregarSuplemento()">A√±adir</button>
    </div>
    <div id="lista-suples"></div>
</section>

<section id="progreso">
    <div class="card">
        <h3>üìâ Evoluci√≥n</h3>
        <input type="number" id="e_peso" placeholder="Peso (kg)">
        <button class="btn btn-main" onclick="registrarEvo()">Registrar</button>
    </div>
    <div id="lista-evo"></div>
</section>

<section id="ajustes">
    <div class="card">
        <h3>‚öôÔ∏è Gear</h3>
        <button class="btn btn-main" onclick="exportarData()">üì§ Exportar Todo</button>
        <button class="btn" style="background:#22c55e; color:white;" onclick="document.getElementById('importInput').click()">üì• Importar Backup</button>
        <input type="file" id="importInput" style="display:none" onchange="importarData(event)">
        <button class="btn" style="background:#ef4444; color:white" onclick="reiniciarCiclo(true)">üîÑ Reiniciar Semana</button>
    </div>
</section>

<script>
let DB = { 
    tema: null, diaActual: 1, 
    rutinas: { "1":[], "2":[], "3":[], "4":[], "5":[], "6":[], "7":[] }, 
    dieta: { menuA: {}, menuB: {} },
    suplementos: [], evo: []
};

function save() { localStorage.setItem('MONOS_FIT_V_FINAL_PRO', JSON.stringify(DB)); }

function load() {
    const data = localStorage.getItem('MONOS_FIT_V_FINAL_PRO');
    if(data) {
        DB = JSON.parse(data);
        if(DB.tema) aplicarTema(DB.tema);
        else document.getElementById('pantalla-inicio').style.display = 'flex';
    }
}

function elegirTema(t) { DB.tema = t; aplicarTema(t); save(); }

function aplicarTema(t) {
    document.body.className = 'tema-' + t;
    document.getElementById('pantalla-inicio').style.display = 'none';
    renderTodo();
}

function renderTodo() {
    renderEntrenamiento(); renderPlan(); renderSuples(); renderEvo();
}

// --- LOGICA DE RUTINAS Y PLAN ---
function guardarEjercicio() {
    const dia = document.getElementById('r_dia').value;
    const nombre = document.getElementById('r_nombre').value;
    const series = document.getElementById('r_series').value;
    const file = document.getElementById('r_file').files[0];
    const editIdx = parseInt(document.getElementById('edit_index').value);

    if(!nombre) return alert("Escribe el nombre del ejercicio");

    const procesar = (imgData) => {
        const nuevoEj = { nombre, series, done: false };
        
        if(editIdx > -1) {
            // Si editamos, mantenemos la foto vieja si no se subi√≥ una nueva
            nuevoEj.img = imgData || DB.rutinas[dia][editIdx].img;
            DB.rutinas[dia][editIdx] = nuevoEj;
            alert("Ejercicio actualizado");
        } else {
            nuevoEj.img = imgData || "";
            DB.rutinas[dia].push(nuevoEj);
            alert("Ejercicio a√±adido");
        }
        
        cancelarEdicion();
        save(); renderTodo();
    };

    if(file) {
        const reader = new FileReader();
        reader.onload = (e) => procesar(e.target.result);
        reader.readAsDataURL(file);
    } else {
        procesar(null);
    }
}

function renderPlan() {
    const cont = document.getElementById('visor-plan-detallado');
    cont.innerHTML = "<h3>Rutinas Cargadas</h3>";
    
    let hayInfo = false;
    for(let d = 1; d <= 7; d++) {
        const ejs = DB.rutinas[d.toString()];
        if(ejs && ejs.length > 0) {
            hayInfo = true;
            const divDia = document.createElement('div');
            divDia.innerHTML = `<h4>D√≠a ${d}</h4>`;
            
            ejs.forEach((ej, idx) => {
                const item = document.createElement('div');
                item.className = 'ex-card';
                item.innerHTML = `
                    <img src="${ej.img}" class="ex-img" onerror="this.src='https://via.placeholder.com/60?text=üèãÔ∏è'">
                    <div style="flex:1">
                        <b>${ej.nombre}</b><br><small>${ej.series}</small>
                    </div>
                    <div>
                        <button class="btn-edit" onclick="prepararEdicion('${d}', ${idx})">‚úèÔ∏è</button>
                        <button class="btn-del" onclick="eliminarEj('${d}', ${idx})">üóëÔ∏è</button>
                    </div>
                `;
                divDia.appendChild(item);
            });
            cont.appendChild(divDia);
        }
    }
    if(!hayInfo) cont.innerHTML += "<p style='text-align:center; opacity:0.5;'>No hay ejercicios cargados.</p>";
}

function eliminarEj(dia, idx) {
    if(confirm("¬øEliminar este ejercicio?")) {
        DB.rutinas[dia].splice(idx, 1);
        save(); renderTodo();
    }
}

function prepararEdicion(dia, idx) {
    const ej = DB.rutinas[dia][idx];
    document.getElementById('r_dia').value = dia;
    document.getElementById('r_nombre').value = ej.nombre;
    document.getElementById('r_series').value = ej.series;
    document.getElementById('edit_index').value = idx;
    
    document.getElementById('form-title').innerText = "‚úèÔ∏è Editando Ejercicio";
    document.getElementById('btn-cancel-edit').style.display = "block";
    window.scrollTo({ top: 0, behavior: 'smooth' });
}

function cancelarEdicion() {
    document.getElementById('edit_index').value = "-1";
    document.getElementById('r_nombre').value = "";
    document.getElementById('r_series').value = "";
    document.getElementById('r_file').value = "";
    document.getElementById('form-title').innerText = "üìù Agregar Ejercicio";
    document.getElementById('btn-cancel-edit').style.display = "none";
}

// --- LOGICA DE PROGRESO DIARIO ---
function renderEntrenamiento() {
    const cont = document.getElementById('listaEntrenamiento');
    const bar = document.getElementById('bar');
    const status = document.getElementById('status-dia');
    const dia = DB.diaActual || 1;
    const ejercicios = DB.rutinas[dia.toString()] || [];
    
    cont.innerHTML = `<h2>Ejercicios de Hoy</h2>`;
    let completados = 0;
    
    if(ejercicios.length === 0) {
        cont.innerHTML += `<p style="text-align:center; padding:20px;">No hay ejercicios para el D√≠a ${dia}. <br>Agr√©galos en la pesta√±a PLAN.</p>`;
    }

    ejercicios.forEach((ej, idx) => {
        if(ej.done) completados++;
        const div = document.createElement('div');
        div.className = 'ex-card';
        div.innerHTML = `
            <img src="${ej.img}" class="ex-img" onerror="this.src='https://via.placeholder.com/60?text=üèãÔ∏è'">
            <div style="flex:1"><b>${ej.nombre}</b><br><small>${ej.series}</small></div>
            <input type="checkbox" style="width:28px; height:28px;" ${ej.done?'checked':''} onchange="completarEj(${idx})">
        `;
        cont.appendChild(div);
    });

    const p = ejercicios.length ? (completados / ejercicios.length) * 100 : 0;
    bar.style.width = p + "%";
    status.innerText = `D√≠a ${dia} - ${Math.round(p)}%`;

    if(p === 100 && ejercicios.length > 0) {
        setTimeout(() => {
            let sig = dia + 1;
            if(DB.rutinas[sig.toString()] && DB.rutinas[sig.toString()].length > 0) {
                alert(`¬°D√≠a ${dia} listo! Pasando al D√≠a ${sig}`);
                DB.diaActual = sig; save(); renderTodo();
            } else {
                alert("¬°Semana completada! Reiniciando a D√≠a 1.");
                reiniciarCiclo(false);
            }
        }, 600);
    }
}

function completarEj(idx) {
    DB.rutinas[DB.diaActual][idx].done = !DB.rutinas[DB.diaActual][idx].done;
    save(); renderEntrenamiento();
}

function reiniciarCiclo(manual) {
    DB.diaActual = 1;
    for(let d in DB.rutinas) DB.rutinas[d].forEach(e => e.done = false);
    save(); renderTodo();
    if(manual) alert("Semana reiniciada.");
}

// --- OTRAS FUNCIONES ---
function agregarSuplemento() {
    const n = document.getElementById('s_nombre').value;
    const m = document.getElementById('s_momento').value;
    if(n) { DB.suplementos.push({nombre:n, momento:m}); save(); renderSuples(); }
}
function renderSuples() {
    document.getElementById('lista-suples').innerHTML = DB.suplementos.map((s,i) => `
    <div class="ex-card"><b>${s.nombre}</b> - ${s.momento} 
    <button class="btn-del" style="margin-left:auto" onclick="DB.suplementos.splice(${i},1);save();renderSuples();">√ó</button></div>`).join('');
}
function registrarEvo() {
    const p = document.getElementById('e_peso').value;
    if(p) { DB.evo.unshift({fecha: new Date().toLocaleDateString(), peso: p}); save(); renderEvo(); }
}
function renderEvo() {
    document.getElementById('lista-evo').innerHTML = DB.evo.map(e => `<div class="card"><b>${e.fecha}:</b> ${e.peso}kg</div>`).join('');
}
function cargarFormDieta() {
    const m = DB.dieta[document.getElementById('d_menu_sel').value] || {};
    document.getElementById('d_des').value = m.desayuno || "";
    document.getElementById('d_s1').value = m.snack1 || "";
    document.getElementById('d_com').value = m.comida || "";
    document.getElementById('d_s2').value = m.snack2 || "";
    document.getElementById('d_cen').value = m.cena || "";
}
function guardarDieta() {
    const s = document.getElementById('d_menu_sel').value;
    DB.dieta[s] = {desayuno: document.getElementById('d_des').value, snack1: document.getElementById('d_s1').value, comida: document.getElementById('d_com').value, snack2: document.getElementById('d_s2').value, cena: document.getElementById('d_cen').value};
    save(); alert("Dieta guardada");
}
function exportarData() {
    const blob = new Blob([JSON.stringify(DB)], {type:'application/json'});
    const a = document.createElement('a'); a.href = URL.createObjectURL(blob);
    a.download = 'monos_fit_backup.json'; a.click();
}
function importarData(e) {
    const r = new FileReader();
    r.onload = (ev) => { DB = JSON.parse(ev.target.result); save(); location.reload(); };
    r.readAsText(e.target.files[0]);
}

document.querySelectorAll('nav button').forEach(btn => {
    btn.addEventListener('click', () => {
        document.querySelectorAll('nav button').forEach(b => b.classList.remove('active'));
        document.querySelectorAll('section').forEach(s => s.classList.remove('active'));
        btn.classList.add('active');
        document.getElementById(btn.dataset.section).classList.add('active');
        if(btn.dataset.section === 'entrenar') renderEntrenamiento();
    });
});

load();
cargarFormDieta();
</script>
</body>
</html>
